import{defaultSettings,tryParseLegacy}from'./types.js';let g_tabId,g_newTab=!1;function createNewTab(a){chrome.tabs.query({active:!0,currentWindow:!0},b=>{chrome.tabs.create({index:b[0].index+1,url:a},a=>{g_tabId=a.id,chrome.tabs.onRemoved.addListener(a=>{g_tabId===a&&(g_tabId=void 0)})})})}function onTransClick(a,b){const c=`http://translate.google.com/#auto/${b}/${encodeURIComponent(a.selectionText)}`;g_newTab||g_tabId===void 0?createNewTab(c):chrome.tabs.update(g_tabId,{active:!0,url:c},a=>{a?chrome.windows.update(a.windowId,{focused:!0}):createNewTab(c)})}chrome.contextMenus.onClicked.addListener(a=>{const b=a.menuItemId.toString();switch(b){case'3e15632a-128e-4a49-873d-4d88a6ab9c92':case'5bd7ff62-f469-4ad7-a2eb-0b5759ec57b3':chrome.runtime.openOptionsPage();break;default:if(b.startsWith('9b969d97-7fdb-46a4-b795-5c849ab2fb5d')){const c=b.substring(37);onTransClick(a,c)}}});function loadContextMenus(a){chrome.contextMenus.removeAll();for(const b of a)chrome.contextMenus.create({id:'9b969d97-7fdb-46a4-b795-5c849ab2fb5d:'+b.code,title:1===a.length?`Translate "%s" to ${b.name}`:`To ${b.name}`,contexts:['selection']});1<a.length&&chrome.contextMenus.create({id:'a76907ab-8574-44a1-b57c-81258e0c0a9f',type:'separator',contexts:['selection']}),1!==a.length&&chrome.contextMenus.create({id:'3e15632a-128e-4a49-873d-4d88a6ab9c92',title:0===a.length?'Translate Options...':'More...',contexts:['selection']}),chrome.contextMenus.create({id:'5bd7ff62-f469-4ad7-a2eb-0b5759ec57b3',title:'Translate Options...',contexts:['page']})}chrome.storage.sync.get(defaultSettings,a=>{const{newTab:b,languages:c}=tryParseLegacy(a);g_newTab=b,loadContextMenus(c)});